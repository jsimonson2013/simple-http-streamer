<html>
<head>
<script>
	const constraints = { audio: true }
	let chunks = []

	navigator.mediaDevices.getUserMedia(constraints)
	.then(stream => {
		const record = document.getElementById('record')
		const mediaRecorder = new MediaRecorder(stream)

		record.onclick = () => { mediaRecorder.start(2000) }

		mediaRecorder.ondataavailable = e => {
			chunks.push(e.data)

			const blob = new Blob(['', chunks[chunks.length - 1]], {'type' : 'audio/ogg; codec: vorbis;'})

			fetch('http://localhost:6123/', {
				method: 'POST',
				body: blob,
				headers:{
					'Content-Type': 'application/octet-stream'
				}
			})
			.catch(error => console.error('Error:', error))
		}

		const quit = document.getElementById('quit')
		quit.onclick = () => {
			fetch('http://localhost:6123/quit', {method: 'GET'})
			.catch(error => console.error('Error:', error))
			window.open(self.location, '_self')
		}
	})
	.catch(err => {
		console.log('The following error occurred: ' + err)
	})
</script>
</head>
<body>
	<button id="record">Record</button>
	<button id="quit">Quit</button>
</body>
</html>
