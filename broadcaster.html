<html>
<head>
<meta charset="UTF-8">
<script>
// create new blob with new audio chunk, send to server
function uploadRecording(audioChunk) {
	const blob = new Blob(['', audioChunk], {'type' : 'audio/ogg; codec: vorbis;'})
	fetch('http://localhost:6123/', {
		method: 'POST',
		body: blob,
		headers:{
			'Content-Type': 'application/octet-stream'
		}
	})
}

// deletes audio file and reloads tab
function quitRecording() {
	fetch('http://localhost:6123/quit', {method: 'GET'})
	.then(() => {window.open(self.location, '_self')})
}

function startAudioCapture() {
	navigator.mediaDevices.getUserMedia({ audio: true })
	.then(stream => {
		// capture data in 2-second chunks
		const mediaRecorder = new MediaRecorder(stream)
		mediaRecorder.start(2000)

		// upload new chunk when it is available
		mediaRecorder.ondataavailable = event => {
			uploadRecording(event.data)
		}
	})
}
</script>
</head>
<body>
	<button id="record" onclick="startAudioCapture()">Record</button>
	<button id="quit" onclick="quitRecording()">Quit</button>
</body>
</html>
